<!DOCTYPE html>
<html>
    <head>
        <title><%= render.title %></title>
        <meta name="baidu-site-verification" content="MHHnqSmeTw" />
        <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
        <script src=<%= run[run.env].boomerang %>></script>
        <script src=<%= run[run.env].history %>></script>
        <script>
            window.apps_map_callback = function(url) {
                if (!url) {
                    return '';
                }
                const target = url.split('?')[0];
                <% if (run.env === 'production'){ %>
                    const apps = {
                        pages: {
                            is_main: false,
                            rules: ['http://219.243.215.203:15566/api/apps/list', 'http://219.243.215.203:15566/apps']
                        },
                        search: {
                            is_main: false,
                            rules: ['http://219.243.215.203:15566/search']
                        },
                        setting: {
                            is_main: false,
                            rules: ['http://219.243.215.203:15566/setting']
                        },
                        main: {
                            is_main: true,
                            rules: ['http://219.243.215.203:15566/js', 'http://219.243.215.203:15566/css', 'http://219.243.215.203:15566/api/system/list', 'http://219.243.215.203:15566/images', 'http://219.243.215.203:15566/reportPerformance', 'http://219.243.215.203:15566/']
                        }
                    };
                <%} else if (run.env === 'pre') { %>
                    const apps = {
                        pages: {
                            is_main: false,
                            rules: ['http://dev.ki3.org.cn/api/apps/list', 'http://dev.ki3.org.cn/apps']
                        },
                        search: {
                            is_main: false,
                            rules: ['http://dev.ki3.org.cn/search']
                        },
                        setting: {
                            is_main: false,
                            rules: ['http://dev.ki3.org.cn/setting']
                        },
                        main: {
                            is_main: true,
                            rules: ['http://dev.ki3.org.cn/js', 'http://dev.ki3.org.cn/css', 'http://dev.ki3.org.cn/api/system/list', 'http://dev.ki3.org.cn/images', 'http://dev.ki3.org.cn/reportPerformance', 'http://dev.ki3.org.cn/']
                        }
                    };
                <%} else { %>
                    const apps = {
                        pages: {
                            is_main: false,
                            rules: ['http://dev.ki3.org.cn/api/apps/list', 'http://dev.ki3.org.cn/apps']
                        },
                        search: {
                            is_main: false,
                            rules: ['http://dev.ki3.org.cn/search']
                        },
                        setting: {
                            is_main: false,
                            rules: ['http://dev.ki3.org.cn/setting']
                        },
                        main: {
                            is_main: true,
                            rules: ['http://dev.ki3.org.cn/js','http://dev.ki3.org.cn/css','http://dev.ki3.org.cn/api/system/list','http://dev.ki3.org.cn/images','http://dev.ki3.org.cn/reportPerformance', 'http://dev.ki3.org.cn/']
                        }
                    };
                <%} %>
                let appInfo = {
                    app: 'unknown',
                    is_main: false
                };
                for (let key in apps) {
                    const matched = apps[key].rules.find(function(item){ return target.search(item) !== -1});
                    if (matched) {
                        appInfo.app = key;
                        appInfo.is_main = apps[key].is_main;
                        break
                    }
                }
                return appInfo;
            };
            BOOMR.init({ beacon_url:"<%= run[run.env].reportApi %>", uuid:"<%= run[run.env].appid %>", autorun: false, History: { enabled: true, auto: true, monitorReplaceState: true }, apps_map_callback: window.apps_map_callback });
        </script>
         <% for(var i=0; i < run.links.length; i++){ %>
            <% if(run.links[i].type){ %>
                <link rel=<%= run.links[i].rel %> href=<%= run.links[i].src %> type=<%= run.links[i].type %>>
            <%} else{ %>
                <link rel=<%= run.links[i].rel %> href=<%= run.links[i].src %>>
            <%} %>
        <%}%>

        <% for(var i=0; i < run.scripts.length; i++) { %>
            <script src=<%= run.scripts[i] %>></script>
        <%}%>
        <script type="text/javascript" src="https://api.map.baidu.com/api?v=3.0&ak=G8PGhp7ECDN29pQ5cnwRQFSIyeE4IkUq"></script>
    </head>
    <body id="body">
        <%- body %>
    </body>
</html>